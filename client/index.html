<canvas id='ctx' width='240' height='160'></canvas>
<link rel='stylesheet' type='text/css' href='css/index.css'>
<script src='https://cdn.socket.io/socket.io-1.4.5.js'></script>
<script>
    var canvas = document.getElementById("ctx");
    var ctx = canvas.getContext("2d");

    var socket = io();

    var playerImage = new Image();
    playerImage.src = "/img/player.png";

    socket.on("positions", function (data) {
        ctx.clearRect(0, 0, 240, 160);
        for (var i = 0; i < data.length; i++) {
            drawPlayer(
                data[i].facing,
                data[i].frame,
                data[i].x,
                data[i].y
            );
        }
    });

    document.onkeydown = function (event) {
        var type = keyPress(event.keyCode);
        socket.emit("keyPress", {
            "type"  :   type,
            "state" :   true,
        });
    }

    document.onkeyup = function (event) {
        var type = keyPress(event.keyCode);
        socket.emit("keyPress", {
            "type"  :   type,
            "state" :   false,
        });
    }

    function keyPress (key) {
        switch (key) {
            case 68:
            case 39:
                return "right";

            case 83:
            case 40:
                return "down";

            case 65:
            case 37:
                return "left";

            case 87:
            case 38:
                return "up";

            default:
                return 0;
        }
    }

    function drawPlayer (direction, frame, x, y) {
        switch (direction) {
            case "up":
                var imageY = 0;
                break;

            case "right":
                var imageY = 32;
                break;

            case "down":
                var imageY = 64;
                break;

            case "left":
                var imageY = 96;
                break;
        }

        ctx.drawImage(
            playerImage,
            24 * frame,
            imageY,
            24,
            32,
            x,
            y,
            24,
            32
        );
    }

</script>
